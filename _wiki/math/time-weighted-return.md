---
layout  : wiki
title   : 외부 흐름을 고려한 투자 수익률을 계산하는 방법
summary : 시간 가중 수익률
date    : 2024-03-15 23:27:32 +0900
updated : 2024-03-15 23:27:32 +0900
tag     : 
toc     : true
public  : true
parent  : [[/math]] 
latex   : false
resource: 47A101B9-9F49-4128-969E-26961FED6941
---
* TOC
{:toc}

## 도입 이유
전 월 대비 투자자의 수익률을 보고서로 만드는중 누적 수익률에 관한 계산이 필요했고 투자자의 기초 자산은 추가 투입되거나 감소 가능한 변수인데 
이를 고려해서 펀드를 운용하는 매니저 입장에서 수익률을 어떻게 도출 할 것인가? 이 문제를 해결하고자 시간 가중 수익률을 적용했고 이해한 내용을 정리합니다.

## 시간 가중 수익률
시간 가중 수익률(TWR)은 투자 수익률을 계산하는 방법으로, 하위 기간에 대한 수익률을 *독립적*으로 합산 하고 각 하위 기간의 기간에 따라 가중치를 적용합니다. 
시간가중법은 외부 흐름을 보상하는 방식에서 투자 수익을 계산하는 다른 방법과 다릅니다.

**시간 가중치 수익률 계산의 목적은 투자 결정의 성과를 평가하는 것**이며, 

투자자의 자본 조정 행위(입출금)가 수익률 측정에 영향을 미치지 않도록 하는 것

$$
TWRR=(i=1∏n (1+ri))−1
$$

기간별 수익 계산 : (1+profit) * (1 + n profit) - 1 

(1 + 해당 기간 수익률) 들의 곱과 마지막에 원금 1을(100%) 뺀다.


## **문제점**

### 단순 월별 성과를 수익률로 표현할때 생기는 뻥튀기

A 사용자의 기초자산은 100원으로 시작. 

1월에 투자를 시작해서 1월말 마감자산은 200원으로 100% 상승했다. 
이때 800원을 추가 입금해서 2월 투자는 1000으로 시작해서 2월 29일 마지막날 자산은 800원이다. 
현재 자산 기준으로 비교를 하면 1000원에서 시작하여 800원으로 끝났기 때문에 -200원(20%)를 손해

하지만 리포트는 이전달 마감자산(200원)과 이번달의 마감자산(800원)을 비교한다. 따라서 손실이 아닌 수익으로 보이게된다. 
중간에 추가되거나 감소한 기초 자산을 고려하지 않고 단순히 월별 자산의 증감을 비교하기 때문이다.

```python
월 수익금 : 현재 마감자산 - 이전달 마감자산
월 수익률 : 월 수익금 / 이전달 마감자산
```

2월달 리포트 기준으로 전달 마감자산과 이번달 마감자산은 200원과 800원이라 비교 시 월 수익금은 600원, 
수익률은 1월의 마감자산과 비교했을때 3배차이 300%다. 누적 수익금은 리포트의 월 수익금을 모두 더 한 값으로 1월 100원 2월 600원, 700원이고 

시간 가중 누적 수익률은 (1+100%) * (1 + 300%) - 1 = 700%이 계산된다.

---

다시 원론적으로 시간 가중 수익률을 선택한 이유는 투자자의 기초자산 조정 행위가 수익률 측정에 영향을 미
치지 않도록 하는 것이다. 리포트를 계산하는 시점에 기초자산을 조회하여 전달 마감자산에 반영한 계산이 필요

기초 자산 컬럼 추가가 필요했다.

```python
last_month_asset = last_month_asset + (계산 시점 기초자산 - 전달 기초자산)
200 + (100+800) - (100)= 1000

monthly_profit = this_month_asset - last_month_asset
800 - 1000 = -200

monthly_profit_rate = monthly_profit / last_month_asset
- 200 / 1000 = -0.2
```

---

**투자자 입장**

1. 1월달에 기초자산 100원시작 200원(100%)
2. 2월달에 800원 추가 입금해서 1000원 시작 → 800원(-20%)
3. 누적 수익률은 2월 마감자산(800원) / 1월달 기초자산 + 추가로 넣은 내 돈(900원) 
4. 800 / 900 = 0.89 
5. (800 / 900) - 1 = -0.11
6. 내 총 자산 900원 대비 -11% 손실

따라서 투자자 관점에서는 시간 가중 수익률이 아니라 금액가중수익률로 계산해야함

---

**펀드 매니저 입장**

1. 1월달의 수익률 100% 
2. 2월달의 수익률 -20%
3. 시간 가중 누적 수익률은 (1 + 100% ) * ( 1 - 20%) - 1 = 60%

펀드 매니저 입장에서 시간 가중 수익률을 사용하는 것이 합리적인 이유는 투자 성과를 측정할 때 투자자의 자본 입출금이 
투자 성과에 미치는 영향을 제거하고 오직 순수한 투자 성과만을 반영(고객이 고점에 투자금 추가 하거나 저점에 투자금 회수 하는거까지 투자 성과에 고려 불가)

## 결론
시간 가중 수익률은 투자 포트폴리오의 성과를 측정하는 방법으로, 포트폴리오에 대한 외부 흐름(예: 현금 유입 및 유출)을 고려하여 계산됩니다. 
이 방법은 포트폴리오에 돈이 들어오거나 나갈 때마다 시간을 여러 하위 기간으로 나누고, 각 하위 기간의 독립적인 수익률을 연결하여 전체 기간의 성과를 측정합니다. 

각 하위 기간 동안의 성과가 다음 기간의 투자 규모에 영향을 미치지 않도록 하여, 투자자의 실제 투자 성과와는 관계없이 포트폴리오 관리자의 성과를 평가하는 데 유용합니다.

간단히 말해, 시간 가중 수익률은 투자 포트폴리오의 성과를 외부 자금 흐름의 영향으로부터 분리하여 평가하는 방법입니다. 
이를 통해 투자자가 언제 자금을 투입하거나 인출하든지 관계없이 포트폴리오 관리의 효율성을 객관적으로 비교할 수 있습니다.